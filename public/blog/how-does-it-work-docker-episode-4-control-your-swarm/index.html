<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Tech, fun and cookies">

    <title>How does it work? Docker! Episode 4 - Control your Swarm! - Sebiwi</title>

    
    <link rel="stylesheet" href="/css/style.css">

    
    
    <meta property="og:title" content="How does it work? Docker! Episode 4 - Control your Swarm!">
    <meta property="og:description" content="Tech, fun and cookies">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://localhost:1313/blog/how-does-it-work-docker-episode-4-control-your-swarm/">
    

    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@sebiwicb">
    <meta name="twitter:title" content="How does it work? Docker! Episode 4 - Control your Swarm!">
    <meta name="twitter:description" content="Tech, fun and cookies">
    

    
    <meta name="color-scheme" content="light dark">
</head>
<body>
    <header class="site-header">
    <div class="container">
        <a href="/" class="site-title">Sebiwi</a>
        <nav class="site-nav">
            <a href="/blog/">Blog</a>
            <a href="/comics/">Comics</a>
            <a href="/tags/">Tags</a>
        </nav>
    </div>
</header>


    <main>
        
<article class="post">
    <div class="container">
        <header class="post-header">
            

            <h1 class="post-title">How does it work? Docker! Episode 4 - Control your Swarm!</h1>

            <div class="post-meta">
                <time datetime="2017-10-02">
                    Monday, October 02, 2017
                </time>

                
                <span class="read-time">11 min read</span>
                
            </div>

            
            
            <div class="post-tags">
                
                <a href="/tags/docker" class="tag">docker</a>
                
                <a href="/tags/infrastructure-as-code" class="tag">infrastructure as code</a>
                
            </div>
            
            
        </header>

        <div class="post-content">
            <h2 id="code-please">Code, please!</h2>
<p>Yay, code!</p>
<p>First of all, we will need the actual virtual machines where our
cluster will run. We will create these using Vagrant. If you don’t
know what Vagrant is, or why are we using it, <a href="https://sebiwi.github.io/blog/how-does-it-work-kube-3/">check out this article</a>.</p>
<p>For this deployment, we will have three Manager nodes, and three
worker nodes.  Why three Manager nodes you say? It may seem overkill,
but in order to have High Availability you need to have an odd number
of Manager nodes, otherwise, you will not get consensus from Raft. We
will see this in action later on.</p>
<p>We do not need an etcd cluster, since the key-value datastore is
already included in the internals of the Docker Engine, and therefore,
we will not include any machines for it.</p>
<p>First of all, I’ll describe the amount of machines I want and their
configurations as variables:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># General cluster configuration</span>
</span></span><span style="display:flex;"><span>$swarm_manager_instances <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>$swarm_manager_instance_memory <span style="color:#f92672">=</span> <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>$swarm_manager_instance_cpus <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>$swarm_worker_instances <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>$swarm_worker_instance_memory <span style="color:#f92672">=</span> <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>$swarm_worker_instance_cpus <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>Afterwards, I’ll specify that I want to use the CoreOs (Contaner
Linux) Vagrant box, from an URL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># Box management: CoreOS</span>
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;coreos-stable&#34;</span>
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://storage.googleapis.com/stable.release.core-os.net/amd64-usr/current/coreos_production_vagrant.json&#34;</span>
</span></span></code></pre></div><p>Just a little reminder, Container Linux is a lightweight Linux
distribution that uses container to run applications. It ships with
basic GNU utilities so you can do all your business, and some other
interesting things, like kubelet, Docker, etcd and flannel. We’ll only
be using Docker for this part. In short, CoreOS’s Container Linux is
an OS specially designed to run containers, and we’re going to profit
from that in our context. If you wanna know more about CoreOS, <a href="https://sebiwi.github.io/blog/how-does-it-work-kube-3/">check
this article</a>.</p>
<p>We’ll configure our Manager nodes with the variables we previously
defined:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># Swarm manager instances configuration</span>
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span>$swarm_manager_instances)<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>define vm_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;swarm-manager-%02d&#34;</span> <span style="color:#f92672">%</span> i <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>master<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Name</span>
</span></span><span style="display:flex;"><span>    master<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> vm_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># RAM, CPU</span>
</span></span><span style="display:flex;"><span>    master<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">:virtualbox</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>vb<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>gui <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>memory <span style="color:#f92672">=</span> $swarm_manager_instance_memory
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>cpus <span style="color:#f92672">=</span> $swarm_manager_instance_cpus
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># IP</span>
</span></span><span style="display:flex;"><span>    master<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">:private_network</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;10.0.0.</span><span style="color:#e6db74">#{</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">110</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>And then we’ll do the same thing with our Worker nodes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># Swarm worker instances configuration</span>
</span></span><span style="display:flex;"><span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span>$swarm_worker_instances)<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>define vm_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;swarm-worker-%02d&#34;</span> <span style="color:#f92672">%</span> i <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>worker<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Name</span>
</span></span><span style="display:flex;"><span>    worker<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> vm_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># RAM, CPU</span>
</span></span><span style="display:flex;"><span>    worker<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">:virtualbox</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>vb<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>gui <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>memory <span style="color:#f92672">=</span> $swarm_worker_instance_memory
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>cpus <span style="color:#f92672">=</span> $swarm_worker_instance_cpus
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># IP</span>
</span></span><span style="display:flex;"><span>    worker<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">:private_network</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;10.0.0.</span><span style="color:#e6db74">#{</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">120</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Easy. If you wanna take a look at the Vagrantfile, it’s right here. Moving on.</p>
<script type="text/javascript" src="https://asciinema.org/a/qCbprH0VYRFHDhDhXGvDUXDkE.js" id="asciicast-qCbprH0VYRFHDhDhXGvDUXDkE" async height="5"></script>
<p>Next up, I’ll set up a Makefile with a Vagrant target, which will
create all the virtual machines, and generate a configuration file
with the SSH configuration needed to interact with them. Ill also add
a clean target, which will destroy all the machines, and it will
delete the SSH configuration file, if it exists.</p>
<pre tabindex="0"><code class="language-raw" data-lang="raw">.PHONY: vagrant clean

vagrant:
    &#34;@vagrant up&#34;
    @vagrant ssh-config &gt; ssh.config

clean:
    @vagrant destroy -f
    @[ ! -f ssh.config ] || rm ssh.config
</code></pre><p>I’ll also put in a list of phony targets, since the targets previously
defined are just actions and don’t really generate files.</p>
<p>We’ve got the virtual machines, and the SSH configuration. For the
Ansible part, we’ll start by creating an inventory with all our six
nodes in it, separated by groups:</p>
<pre tabindex="0"><code>[swarm-leader]
swarm-manager-01

[swarm-manager]
swarm-manager-01
swarm-manager-02
swarm-manager-03

[swarm-worker]
swarm-worker-01
swarm-worker-02
swarm-worker-03
</code></pre><p>You will probably notice there is a <code>swarm-leader</code> group in the
inventory, which contains a single host. Like I said in the first
article, there might be many Managers in a cluster; Nevertheless,
there is only one Leader at any given moment. We will use this group
to launch specific actions for the Leader, common actions for all
Manager nodes using the swarm-manager group, and actions destined for
the non-Leader Manager nodes using the swarm-manager group, and
subtracting the swarm-leader group from it. This may seem complex, but
it is actually super easy, you will see.</p>
<p>No IP configurations over here, we’ll just use the SSH configuration
file we generated earlier. In order to do that, we have to specify it
on our ansible.cfg file. No ansible.cfg file? Just create it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[defaults]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ansible_managed</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">Please do not modify this file directly as it is managed by Ansible and could be overwritten.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">retry_files_enabled</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">false</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">remote_user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">core</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[ssh_connection]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ssh_args</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">-F ssh.config</span>
</span></span></code></pre></div><p>We’ll also disable retry_files, and specify that we want to use the
“core” user when connecting to the machines using SSH.</p>
<p>I’ve already said this before, but CoreOS only ships with basic GNU
utilities, which means no Python. And no Python means no Ansible,
except for the raw module, the script module and the synchronize
module. What we’re going to do is that we’re going to install a
lightweight Python implementation called PyPy using only those
modules, and then use that Python implementation in order to execute
the rest of our playbook. Neat huh?</p>
<p>We’ll use the same role we used for the Kubernetes provisioning
project. <a href="https://sebiwi.github.io/blog/how-does-it-work-kube-4/">If you want to read more about it, like the technical
explanation behind it, you can find all the information here</a>.</p>
<p>So basically, we’ve got a role now under
roles/bootstrap/ansible-bootstrap, which has 3 files under the tasks
directory: main.yml, configure.yml and test.yml. The configure.yml
file holds all the tasks necessary in order to install PyPy. The
test.yml file verifies if Python is correctly installed by doing
<code>python --version</code>. The main.yml file wraps these two files, adding
the <code>test</code> tag to the test.yml part:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># filename: roles/bootstrap/ansible-bootstrap/tasks/main.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install and configure PyPy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">include</span>: <span style="color:#ae81ff">configure.yml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Test PyPy installation</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">include</span>: <span style="color:#ae81ff">test.yml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tags</span>: [ <span style="color:#ae81ff">test ]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Gather ansible facts</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">setup</span>:
</span></span></code></pre></div><p>I’ll follow this approach for each role on this project, so each role
will have a smoketest, which will be enough to tell us if the
component is correctly installed. This is pretty useful in order to
test the already deployed infrastructure, as a conformance test, and
check for deltas which might need to be corrected.</p>
<p>Now that we have our first role, it’s time to create a playbook. Since
we’ll be deploying a Swarm cluster, I’ll just name it swam.yml:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Bootstrap coreos hosts</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">all</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">gather_facts</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">roles</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">role</span>: <span style="color:#ae81ff">bootstrap/ansible-bootstrap</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tags</span>: [ <span style="color:#ae81ff">ansible-bootstrap ]</span>
</span></span></code></pre></div><p>It’s quite straightforward so far, I’ll just launch the recently
created role on each hosts, without gathering facts, since Python is
not yet installed on the machines. Facts will be gathered at the end
of the role though, as seen on the previous code snippet.</p>
<p>Next up, tests. We’ll use molecule for the win. <a href="https://sebiwi.github.io/blog/how-does-it-work-kube-3/">I spoke to you all
about molecule on a previous article</a>. It is basically a testing tool
for Ansible code. It creates ephemeral infrastructure (either virtual
machines or containers), tests your roles on it (not only the
execution of the roles, but also the syntax and their idempotence),
and then it destroys it. Since there are no CoreOS containers, and
Virtualbox virtual machines through Vagrant being the target platform,
I’ll just use the Vagrant driver.</p>
<p>In order to test with molecule, I’m going to create a molecule.yml
file, in which I’m going to define the Ansible files to use for the
test, as well as the Vagrant machine’s specification and
configuration.</p>
<p>First, I’ll specify which Ansible configuration to use, and which
playbook to run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">ansible</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">config_file</span>: <span style="color:#ae81ff">./ansible.cfg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">playbook</span>: <span style="color:#ae81ff">swarm.yml</span>
</span></span></code></pre></div><p>Then, I’ll specify which Vagrant box to use for the virtual machines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">platforms</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">coreOS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">box</span>: <span style="color:#ae81ff">coreos-stable</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">config.vm.box_url</span>: <span style="color:#ae81ff">https://storage.googleapis.com/stable.release.core-os.net/amd64-usr/current/coreos_production_vagrant.json</span>
</span></span></code></pre></div><p>Then, what will my provider be, and how much physical resources will be used by each instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">providers</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">virtualbox</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">virtualbox</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cpus</span>: <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>After that, I’ll define the specifics of each instance, including both
hostname and IP addresses:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">instances</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">swarm-manager-01</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ansible_groups</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">swarm-leader</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">swarm-manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interfaces</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">network_name</span>: <span style="color:#ae81ff">private_network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">static</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">10.0.0.101</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">auto_config</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">append_platform_to_hostname</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">swarm-manager-02</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ansible_groups</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">swarm-manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interfaces</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">network_name</span>: <span style="color:#ae81ff">private_network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">static</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">10.0.0.102</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">auto_config</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">append_platform_to_hostname</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">swarm-manager-03</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ansible_groups</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">swarm-manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interfaces</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">network_name</span>: <span style="color:#ae81ff">private_network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">static</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">10.0.0.103</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">auto_config</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">append_platform_to_hostname</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">swarm-worker-01</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ansible_groups</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">swarm-worker</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interfaces</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">network_name</span>: <span style="color:#ae81ff">private_network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">static</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">10.0.0.121</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">auto_config</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">append_platform_to_hostname</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>With that in place, I just need to run <code>molecule test</code> in order to
test that my infrastructure is created and configured correctly. This
is actually an oversimplification of everything that can be done using
molecule, but since <a href="https://sebiwi.github.io/blog/how-does-it-work-kube-4/">I already wrote about it on a previous
article</a>,
just can just head there and read about it if you’re really
interested.</p>
<p>And with that, I also get to add two new (phony) Makefile target:</p>
<pre tabindex="0"><code>smoketest:
    @ansible-playbook -i inventories/vagrant.ini swarm.yml --tags test

test:
    @molecule test
</code></pre><p>The smoketest target allows me to run a conformance test on all the
already deployed infrastructure, to check for deltas and see if
something’s wrong whenever I want, and the test target allows me to
test the code on fresh, newly created infrastructure, and to check for
Ansible-specific good practices. Remember, this uses Molecule V1, so
if you try to run it using Molecule V2 it will probably not work.</p>
<p>Tests are set up thusly. Moving on.</p>
<h2 id="manage-lead-and-follow">Manage: Lead and follow</h2>
<p>Next up, we need to setup the three Manager nodes. I’ll start by
creating a swarm-leader role, under the configuration roles directory:</p>
<pre><code>roles/
├── bootstrap
│   └── ansible-bootstrap
└── configure
    └── swarm-leader
         └── tasks
             ├── configure.yml
             ├── main.yml
             └── test.yml
</code></pre>
<p>And for this role, we’ll use the same task division strategy we used
before in order to add our smoketest.</p>
<p>First, the main.yml file, which is fairly simple, and only includes
the other two yaml files, using a tag for the test file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create Manager Leader</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">include</span>: <span style="color:#ae81ff">configure.yml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Test Manager Leader</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">include</span>: <span style="color:#ae81ff">test.yml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tags</span>: [ <span style="color:#ae81ff">test ]</span>
</span></span></code></pre></div><p>The configure file first checks if the cluster is already on Swarm
mode. If it is, it doesn’t do anything else. If it isn’t, it creates
the first Swarm node, creating thus the Swarm cluster, which will be
joined by the subsequent nodes. It also disables scheduling on the
Leader, making sure that the Leader does not handle any workload and
that it concentrates its resources on leading the cluster:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check if Swarm Mode is already activated</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: <span style="color:#ae81ff">docker info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">register</span>: <span style="color:#ae81ff">docker_info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">changed_when</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create Swarm Manager Leader if it is not activated</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: <span style="color:#ae81ff">docker swarm init --advertise-addr {{ hostvars[groups[&#39;swarm-leader&#39;][0]][&#39;ansible_env&#39;][&#39;COREOS_PUBLIC_IPV4&#39;] }}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#e6db74">&#34;&#39;Swarm: active&#39; not in docker_info.stdout&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Disable Leader scheduling</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: <span style="color:#ae81ff">docker node update --availability drain {{ groups[&#39;swarm-leader&#39;][0] }}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#e6db74">&#34;&#39;Swarm: active&#39; not in docker_info.stdout and disable_leader_scheduling&#34;</span>
</span></span></code></pre></div><p>This last part is not actually necessary, specially for small
clusters. Nevertheless it is usually a good practice, since the leader
election process can be really intensive in terms of resource
consumption. The <code>disable_leader_scheduling</code> variable is defined on
the role’s defaults, and you can override it if you want your Leader
to handle workloads.</p>
<p>Fairly simple. Notice the <code>changed_when: false</code> parameter on the first
command task. It is there because running  <code>docker info</code> will not
change the state of the cluster, and it is therefore not a real
action, just a way of collecting information.</p>
<p>Next, for the smoketest, I’ll verify if the created Manager node is in
fact a Leader (which it should be, since it was the first Manager node
to be created), and whether its status is “Drain”, since the Leader
node is not supposed to handle any workload:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check if Manager node is Leader</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shell</span>: <span style="color:#ae81ff">docker node ls | grep {{ ansible_hostname }}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">register</span>: <span style="color:#ae81ff">docker_info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">changed_when</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Fail if Manager node is not Leader</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">assert</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">that</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;&#39;Leader&#39; in docker_info.stdout&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;&#39;Active&#39; in docker_info.stdout&#34;</span>
</span></span></code></pre></div><p>Now that the role is set, I’ll just add it to the swarm.yml playbook:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create Swarm Leader node</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">swarm-leader</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">roles</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">role</span>: <span style="color:#ae81ff">configure/swarm-leader</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tags</span>: [ <span style="color:#ae81ff">swarm-leader ]</span>
</span></span></code></pre></div><p>Using the host group we discussed earlier, and the proper tag in order
to identify the action. And that’s it for the Manager Leader. We need
some non-Manager Leader for that High Availability though!</p>
<p>So we’ll just repeat the previous process, we’ll create a
swarm-manager role up next, with the same structure of the previous
role (main.yml, configure.yml, test.yml).</p>
<p>I won’t show you the main.yml: it is basically the same one we saw
before. The configure.yml file, on the other hand, checks if Swarm
mode is activated on the node, the same way the Leader role does, but
if it isn’t, it recovers the token needed to join the cluster as a
Manager node from the Leader node, and joins the cluster with it. If
Swarm mode is already activated, it does nothing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check if Swarm Mode is already activated</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: <span style="color:#ae81ff">docker info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">register</span>: <span style="color:#ae81ff">docker_info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">changed_when</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Recover Swarm Leader token</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shell</span>: <span style="color:#ae81ff">docker swarm join-token manager | grep token | cut -d &#39; &#39; -f 6</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">register</span>: <span style="color:#ae81ff">leader_token</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#e6db74">&#34;&#39;Swarm: active&#39; not in docker_info.stdout&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">delegate_to</span>: <span style="color:#e6db74">&#34;{{ groups[&#39;swarm-leader&#39;][0] }}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Join Swarm Cluster as Manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: <span style="color:#ae81ff">docker swarm join --token {{ leader_token.stdout }} {{ hostvars[groups[&#39;swarm-leader&#39;][0]][&#39;ansible_env&#39;][&#39;COREOS_PUBLIC_IPV4&#39;] }}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#e6db74">&#34;&#39;Swarm: active&#39; not in docker_info.stdout&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Disable Manager scheduling</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: <span style="color:#ae81ff">docker node update --availability drain {{ ansible_hostname }}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#e6db74">&#34;&#39;Swarm: active&#39; not in docker_info.stdout and disable_manager_scheduling&#34;</span>
</span></span></code></pre></div><p>Notice the <code>delegate_to</code> option on the token recovery task. This needs
to be done because the token must be recovered from the Leader node
and the Leader node only. Scheduling is also disabled on these nodes,
by default, because of the reason specified above on the Leader node.
This time, the <code>disable_manager_scheduling</code> variable is also defined
on the role’s defaults. You can override this variable if you want
your Managers to handle workloads.</p>
<p>The test file verifies different  things as well:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check if node is Manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shell</span>: <span style="color:#ae81ff">docker node ls | grep {{ ansible_hostname }}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">register</span>: <span style="color:#ae81ff">docker_info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">changed_when</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Fail if node is not Manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">assert</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">that</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;&#39;Reachable&#39; in docker_info.stdout&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;&#39;Drain&#39; in docker_info.stdout&#34;</span>
</span></span></code></pre></div><p>It recovers the nodes information, and then it verifies that the node
Manager type is <code>Reachable</code> rather than <code>Leader</code>, as it was for the
Leader node. It also verifies that the nodes are “drained” since we
don’t want them to run containers.</p>
<p>Finally, once the role is ready, I’ll add it to the swarm.yml file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create Swarm Manager nodes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">swarm-manager:!swarm-leader</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">roles</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">role</span>: <span style="color:#ae81ff">configure/swarm-manager</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tags</span>: [ <span style="color:#ae81ff">swarm-manager ]</span>
</span></span></code></pre></div><p>Notice the <code>!</code> sign on the hosts part of the play. This specifies that
we want to run the role on every node on the swarm-manager group, that
isn’t in the swarm-leader group, thus preventing the Leader node to
try to join the cluster as a non-Leader Manager. Sweet!</p>
<p>Once we finish all this, we should have everything we need
Manager-wise. Time to get some Workers running! I’ll probably talk to
you about that on the next article though.</p>
<p>Stay in touch!</p>

        </div>

        
<nav class="post-navigation">
    
    <a href="/blog/how-does-it-work-docker-episode-3-swarm-load-balancing-service-discovery-and-security/" class="post-nav-prev">
        <span class="post-nav-label">&laquo; Previous</span>
        <span class="post-nav-title">How does it work? Docker! Episode 3 - Swarm load balancing, service discovery and security</span>
    </a>
    

    
    <a href="/blog/how-does-it-work-docker-episode-5-get-some-workers-done/" class="post-nav-next">
        <span class="post-nav-label">Next &raquo;</span>
        <span class="post-nav-title">How does it work? Docker! Episode 5 - Get some work(ers) done!</span>
    </a>
    
</nav>



        
        

<section class="related-posts">
    <h3>Related Posts</h3>
    <div class="related-grid">
        
        <article class="related-card">
            <a href="/blog/how-does-it-work-docker-episode-3-swarm-load-balancing-service-discovery-and-security/">
                <h4>How does it work? Docker! Episode 3 - Swarm load balancing, service discovery and security</h4>
                <time datetime="2017-09-21">
                    Sep 21, 2017
                </time>
            </a>
        </article>
        
        <article class="related-card">
            <a href="/blog/how-does-it-work-docker-episode-2-swarm-networking/">
                <h4>How does it work? Docker! Episode 2 - Swarm networking</h4>
                <time datetime="2017-09-04">
                    Sep 04, 2017
                </time>
            </a>
        </article>
        
        <article class="related-card">
            <a href="/blog/how-does-it-work-docker-episode-1-swarm-general-architecture/">
                <h4>How does it work? Docker! Episode 1 - Swarm general architecture</h4>
                <time datetime="2017-06-08">
                    Jun 08, 2017
                </time>
            </a>
        </article>
        
    </div>
</section>


        

        
        <aside class="author-info">
    <img src="/images/profile.jpg" alt="Sebiwi" class="author-avatar">
    <div class="author-details">
        <h4 class="author-name">Sebiwi</h4>
        <p class="author-bio">Tech, fun, and cookies</p>
        <div class="social-links">
    
    <a href="https://twitter.com/sebiwicb" target="_blank" rel="noopener" aria-label="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
        </svg>
    </a>
    

    
    <a href="https://github.com/sebiwi" target="_blank" rel="noopener" aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
    </a>
    

    
    <a href="mailto:contact.sebiwi@gmail.com" aria-label="Email">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
    </a>
    
</div>

    </div>
</aside>

        
    </div>
</article>

    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="social-links">
    
    <a href="https://twitter.com/sebiwicb" target="_blank" rel="noopener" aria-label="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
        </svg>
    </a>
    

    
    <a href="https://github.com/sebiwi" target="_blank" rel="noopener" aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
    </a>
    

    
    <a href="mailto:contact.sebiwi@gmail.com" aria-label="Email">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
    </a>
    
</div>

        <p class="copyright">&copy; 2025 Sebiwi</p>
    </div>
</footer>


    
    <script src="/js/animations.js"></script>
    
</body>
</html>
